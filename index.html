<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Football Card Strategy Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* CSS Custom Properties for dynamic sizing */
        :root {
            --vh: 1vh;
            --game-width: min(400px, 100vw);
            --game-height: calc(var(--vh, 1vh) * 100);
            --field-height: min(280px, 40vh);
            --hand-height: calc(var(--game-height) - var(--field-height));
        }

        html, body {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        }

        body {
            font-family: 'Arial', sans-serif;
            min-height: var(--game-height);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            overflow: hidden;
            position: fixed;
            width: 100%;
            /* Handle iOS safe areas */
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
        }

        .game-container {
            width: var(--game-width);
            height: var(--game-height);
            background: #f8f9fa;
            border-radius: min(20px, 4vw);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .field-section {
            height: var(--field-height);
            flex-shrink: 0;
            background: linear-gradient(180deg, #4CAF50 0%, #45a049 100%);
            position: relative;
            border-bottom: 3px solid #333;
        }

        @keyframes pulse {
            0%, 100% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.05); }
        }

        .field-lines {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                repeating-linear-gradient(0deg, 
                    transparent, 
                    transparent 20px, 
                    rgba(255,255,255,0.3) 20px, 
                    rgba(255,255,255,0.3) 22px);
        }

        .field-zone {
            position: absolute;
            width: 100%;
            height: 50%;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 min(20px, 4vw);
            flex-wrap: wrap;
            overflow: hidden;
        }

        .enemy-zone {
            top: 2.5rem;
            background: rgba(255,0,0,0.1);
        }

        .player-zone {
            bottom: 1.5rem;
            background: rgba(0,0,255,0.1);
        }

        .field-card {
            width: clamp(40px, 12vw, 50px);
            height: clamp(56px, 16vw, 70px);
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: clamp(8px, 2vw, 10px);
            font-weight: bold;
            color: #333;
            cursor: pointer;
            transition: all 0.3s ease;
            transform-style: preserve-3d;
            margin: 1px;
        }

        .field-card:hover {
            transform: translateY(-5px) rotateY(10deg);
            box-shadow: 0 8px 16px rgba(0,0,0,0.4);
        }

        .field-card.enemy {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
        }

        .field-card.player {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            color: white;
        }

        .hand-section {
            flex: 1;
            min-height: 0;
            background: #2c3e50;
            padding: min(20px, 3vh) min(20px, 4vw);
            display: flex;
            flex-direction: column;
        }

        .hand-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: min(20px, 3vh);
            flex-shrink: 0;
        }

        .cards-remaining {
            background: rgba(255,255,255,0.1);
            padding: min(8px, 1.5vh) min(12px, 2.5vw);
            border-radius: 15px;
            color: white;
            font-size: clamp(10px, 2.5vw, 12px);
            backdrop-filter: blur(10px);
        }

        .discard-btn, .play-btn {
            padding: min(10px, 2vh) min(20px, 4vw);
            border: none;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: clamp(10px, 2.5vw, 12px);
        }

        .discard-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .discard-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(231,76,60,0.4);
        }

        .play-btn {
            background: linear-gradient(135deg, #27ae60, #219a52);
            color: white;
        }

        .play-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(39,174,96,0.4);
        }

        .hand-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: min(10px, 2vw);
            flex: 1;
            min-height: 0;
            align-content: start;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            padding: min(8px, 1.5vh);
            color: white;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            transform-style: preserve-3d;
            border: 2px solid transparent;
            aspect-ratio: 3/4;
            min-height: 0;
        }

        .card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
            background-size: 400% 400%;
            border-radius: 12px;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
            animation: gradientShift 3s ease infinite;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .card:hover::before {
            opacity: 1;
        }

        .card:hover {
            transform: translateY(-8px) rotateX(10deg) rotateY(5deg);
            box-shadow: 0 15px 30px rgba(0,0,0,0.4);
        }

        .card.selected {
            transform: translateY(-12px) scale(1.05);
            border-color: #ffd700;
            box-shadow: 0 0 20px rgba(255,215,0,0.6);
        }

        .card.selected::before {
            opacity: 1;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: min(8px, 1.5vh);
        }

        .card-cost {
            width: clamp(16px, 4vw, 20px);
            height: clamp(16px, 4vw, 20px);
            background: #f39c12;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(8px, 2vw, 10px);
            font-weight: bold;
            color: white;
        }

        .card-rarity {
            width: clamp(16px, 4vw, 20px);
            height: clamp(16px, 4vw, 20px);
            background: #e74c3c;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(8px, 2vw, 10px);
            font-weight: bold;
            color: white;
        }

        .card-image {
            width: 100%;
            flex: 1;
            background: linear-gradient(45deg, #2c3e50, #3498db);
            border-radius: 8px;
            margin-bottom: min(8px, 1.5vh);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(10px, 2.5vw, 12px);
            font-weight: bold;
            color: white;
            position: relative;
            overflow: hidden;
            min-height: 0;
        }

        .card-image::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
            transform: rotate(45deg);
            transition: all 0.6s ease;
            opacity: 0;
        }

        .card:hover .card-image::after {
            opacity: 1;
            animation: shine 0.6s ease;
        }

        .position-badge {
            position: absolute;
            top: 2px;
            right: 2px;
            background: rgba(255,255,255,0.9);
            color: #333;
            font-size: clamp(6px, 1.5vw, 8px);
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: bold;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .card-name {
            font-size: clamp(9px, 2vw, 11px);
            font-weight: bold;
            text-align: center;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            flex-shrink: 0;
        }

        .floating-animation {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .slide-in {
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .card-enter {
            animation: cardEnter 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes cardEnter {
            0% { 
                transform: scale(0) rotate(180deg);
                opacity: 0;
            }
            100% { 
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        .field-placement {
            animation: fieldPlace 0.8s ease-out;
        }

        @keyframes fieldPlace {
            0% { 
                transform: scale(1.5) translateY(-50px);
                opacity: 0;
            }
            50% {
                transform: scale(1.2) translateY(-25px);
                opacity: 0.7;
            }
            100% { 
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        @keyframes messageFloat {
            0% { 
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }
            20% { 
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.1);
            }
            80% { 
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            100% { 
                opacity: 0;
                transform: translate(-50%, -60%) scale(0.9);
            }
        }

        .enemy-deck-info {
            position: absolute;
            top: 5px;
            right: min(10px, 2vw);
            background: rgba(255,0,0,0.8);
            color: white;
            padding: min(4px, 1vh) min(8px, 2vw);
            border-radius: 10px;
            font-size: clamp(8px, 2vw, 10px);
            font-weight: bold;
            z-index: 100;
        }

        /* Health bar positioning */
        #enemy-yards-bar {
            position: absolute;
            top: 2rem;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            z-index: 100;
        }

        #player-yards-bar {
            position: absolute;
            bottom: min(10px, 2vh);
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            z-index: 100;
        }

        /* Handle very small screens */
        @media (max-height: 600px) {
            :root {
                --field-height: 35vh;
            }
            
            .hand-cards {
                grid-template-columns: repeat(3, 1fr);
                gap: 5px;
            }
            
            .card {
                padding: 4px;
            }
            
            .hand-controls {
                margin-bottom: 10px;
            }
        }

        /* Handle landscape orientation on mobile */
        @media (orientation: landscape) and (max-height: 500px) {
            .game-container {
                flex-direction: row;
                height: 100vh;
                width: 100vw;
                border-radius: 0;
            }
            
            .field-section {
                width: 40%;
                height: 100%;
            }
            
            .hand-section {
                width: 60%;
                height: 100%;
            }
            
            .field-zone {
                flex-direction: column;
                height: 100%;
                width: 50%;
            }
            
            .enemy-zone {
                left: 0;
                top: 0;
            }
            
            .player-zone {
                right: 0;
                top: 0;
                bottom: auto;
            }
            
            #enemy-yards-bar {
                writing-mode: vertical-rl;
                text-orientation: mixed;
                top: 50%;
                left: 10px;
                transform: translateY(-50%);
                width: auto;
                height: 60%;
            }
            
            #player-yards-bar {
                writing-mode: vertical-rl;
                text-orientation: mixed;
                top: 50%;
                right: 10px;
                left: auto;
                transform: translateY(-50%);
                width: auto;
                height: 60%;
            }
        }

        /* Extra small screens */
        @media (max-width: 320px) {
            .hand-cards {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Touch improvements */
        @media (hover: none) and (pointer: coarse) {
            .card:hover,
            .field-card:hover,
            .discard-btn:hover,
            .play-btn:hover {
                transform: none;
            }
            
            .card:active {
                transform: scale(0.95);
            }
            
            .discard-btn:active,
            .play-btn:active {
                transform: scale(0.95);
            }
        }
    </style>
    <link rel="stylesheet" href="styles/healthbar.css">
</head>
<body>
    <div class="game-container">
        <div class="field-section">
            <div class="field-lines"></div>

            <div id="enemy-yards-bar" class="healthbar-component"></div>
            <div class="enemy-deck-info" id="enemyDeckInfo">Enemy: 9/15</div>
            
            <div class="field-zone enemy-zone" id="enemyZone">
                <!-- Enemy cards will be placed here -->
            </div>
            
            <div class="field-zone player-zone" id="playerZone">
                <!-- Player cards will be placed here -->
            </div>
            
            <div id="player-yards-bar" class="healthbar-component"></div>
        </div>
        
        <div class="hand-section">
            <div class="hand-controls">
                <button class="discard-btn" id="discardBtn">Sub Out</button>
                <div class="cards-remaining">Available 9/15</div>
                <button class="play-btn" id="playBtn">Snap 🏈</button>
            </div>
            
            <div class="hand-cards" id="handCards">
                <!-- Hand cards will be generated here -->
            </div>
        </div>
    </div>

    <script>
        // Set CSS custom property for viewport height
        function setVH() {
            let vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        }

        // Initial set
        setVH();

        // Re-calculate on resize
        window.addEventListener('resize', setVH);

        // Re-calculate on orientation change
        window.addEventListener('orientationchange', () => {
            setTimeout(setVH, 100);
        });

        class GameState {
            constructor() {
                this.selectedCards = new Set();
                this.playerYards = 10;
                this.enemyYards = 0;

                // Health bar instances
                this.playerYardsBar = null;
                this.enemyYardsBar = null;

                this.playerDeck = [
                    { name: 'MAHOMES', cost: 8, rarity: 6, position: 'QB' },
                    { name: 'ALLEN', cost: 7, rarity: 6, position: 'QB' },
                    { name: 'BURROW', cost: 6, rarity: 5, position: 'QB' },
                    { name: 'HURTS', cost: 5, rarity: 4, position: 'QB' },
                    { name: 'LAMAR', cost: 6, rarity: 5, position: 'QB' },
                    { name: 'HENRY', cost: 7, rarity: 5, position: 'RB' },
                    { name: 'MCCAFFREY', cost: 8, rarity: 6, position: 'RB' },
                    { name: 'CHUBB', cost: 5, rarity: 4, position: 'RB' },
                    { name: 'COOK', cost: 4, rarity: 3, position: 'RB' },
                    { name: 'KUPP', cost: 6, rarity: 5, position: 'WR' },
                    { name: 'JEFFERSON', cost: 7, rarity: 6, position: 'WR' },
                    { name: 'DIGGS', cost: 5, rarity: 4, position: 'WR' },
                    { name: 'ADAMS', cost: 6, rarity: 5, position: 'WR' },
                    { name: 'KELCE', cost: 7, rarity: 6, position: 'TE' },
                    { name: 'WATT', cost: 8, rarity: 6, position: 'DE' }
                ];
                this.playerHand = [];
                this.playerDrawPile = [];
                this.playerDiscardPile = [];

                this.fieldCards = {
                    player: [],
                    enemy: []
                };
                this.hasDiscardedThisRound = false;
                this.round = 1;
                
                this.enemyDeck = [
                    { name: 'RODGERS', cost: 7, rarity: 5, position: 'QB' },
                    { name: 'WILSON', cost: 6, rarity: 4, position: 'QB' },
                    { name: 'PRESCOTT', cost: 5, rarity: 4, position: 'QB' },
                    { name: 'STAFFORD', cost: 5, rarity: 3, position: 'QB' },
                    { name: 'JONES', cost: 4, rarity: 3, position: 'QB' },
                    { name: 'BARKLEY', cost: 7, rarity: 5, position: 'RB' },
                    { name: 'JONES II', cost: 6, rarity: 4, position: 'RB' },
                    { name: 'MIXON', cost: 5, rarity: 4, position: 'RB' },
                    { name: 'HARRIS', cost: 4, rarity: 3, position: 'RB' },
                    { name: 'HILL', cost: 7, rarity: 6, position: 'WR' },
                    { name: 'CHASE', cost: 6, rarity: 5, position: 'WR' },
                    { name: 'HOPKINS', cost: 5, rarity: 4, position: 'WR' },
                    { name: 'EVANS', cost: 5, rarity: 4, position: 'WR' },
                    { name: 'KITTLE', cost: 6, rarity: 5, position: 'TE' },
                    { name: 'DONALD', cost: 8, rarity: 6, position: 'DT' }
                ];

                this.enemyHand = [];
                this.enemyDrawPile = [];
                this.enemyDiscardPile = [];
            }

            initializeHealthBars() {
                // Initialize player yards bar
                this.playerYardsBar = new HealthBarComponent('#player-yards-bar', {
                    name: 'Your Yards',
                    initialValue: this.playerYards
                });

                // Initialize enemy yards bar  
                this.enemyYardsBar = new HealthBarComponent('#enemy-yards-bar', {
                    name: 'Enemy Yards',
                    initialValue: this.enemyYards
                });
            }

            init() {
                this.generateInitialHand();
                this.generateEnemyDeck();
                this.setupEventListeners();
                
                // Initialize health bars after DOM is ready
                setTimeout(() => {
                    this.initializeHealthBars();
                }, 100);
                
                this.startNewRound();
                this.updateUI();
            }

            generateInitialHand() {
                const shuffledPlayers = [...this.playerDeck].sort(() => Math.random() - 0.5);
                
                this.playerDrawPile = shuffledPlayers.map((player, index) => ({
                    ...player,
                    id: `deck-${index}`,
                    element: null
                }));
            }

            generateEnemyDeck() {
                const shuffledEnemyPlayers = [...this.enemyDeck].sort(() => Math.random() - 0.5);
                
                this.enemyDrawPile = shuffledEnemyPlayers.map((player, index) => ({
                    ...player,
                    id: `enemy-deck-${index}`
                }));
            }

            generateEnemyHand() {
            }

            playEnemyCards() {
                if (this.enemyHand.length === 0) return 0;

                const cardsToPlay = this.enemyHand.length;
                let totalEnemyPower = 0;

                this.enemyHand.forEach(card => {
                    totalEnemyPower += card.cost + card.rarity;
                    
                    this.fieldCards.enemy.push({
                        name: card.name,
                        position: card.position,
                        cost: card.cost,
                        rarity: card.rarity,
                        id: `enemy-field-${Date.now()}-${Math.random()}`,
                        element: null
                    });
                });

                this.enemyHand = [];
                return totalEnemyPower;
            }

            drawEnemyCards(count) {
                const cardsToDraw = count;
                
                for (let i = 0; i < cardsToDraw; i++) {
                    const newCard = this.enemyDrawPile.shift();
                    if (newCard) {
                        newCard.id = `enemy-hand-${Date.now()}-${Math.random()}`;
                        this.enemyHand.push(newCard);
                    }

                    if (this.getNumberOfCardsInEnemyDrawPile() === 0 && this.getNumberOfCardsInEnemyDiscardPile() > 0) {
                        this.shuffleEnemyDiscardIntoDeck();
                    }
                }
                
                this.enemyCardsRemaining = this.getNumberOfCardsInEnemyDrawPile();
            }

            shuffleEnemyDiscardIntoDeck() {
                const shuffled = [...this.enemyDiscardPile].sort(() => Math.random() - 0.5);
                this.enemyDrawPile.push(...shuffled);
                this.enemyDiscardPile = [];
                this.showMessage("🔄 Enemy deck reshuffled!");
            }

            renderHand() {
                const handContainer = document.getElementById('handCards');
                handContainer.innerHTML = '';

                this.playerHand.forEach((card, index) => {
                    const cardElement = this.createCardElement(card, index);
                    handContainer.appendChild(cardElement);
                    card.element = cardElement;
                    
                    setTimeout(() => {
                        cardElement.classList.add('card-enter');
                    }, index * 100);
                });
            }

            createCardElement(card, index) {
                const cardDiv = document.createElement('div');
                cardDiv.className = 'card floating-animation';
                cardDiv.style.animationDelay = `${index * 0.2}s`;
                cardDiv.dataset.cardId = card.id;
                
                cardDiv.innerHTML = `
                    <div class="card-header">
                        <div class="card-cost">${card.cost}</div>
                        <div class="card-rarity">${card.rarity}</div>
                    </div>
                    <div class="card-image">
                        <div class="position-badge">${card.position}</div>
                        ${card.name}
                    </div>
                    <div class="card-name">${card.name}</div>
                `;

                cardDiv.addEventListener('click', () => this.toggleCardSelection(card.id));
                return cardDiv;
            }

            renderFieldCards() {
                const enemyZone = document.getElementById('enemyZone');
                const playerZone = document.getElementById('playerZone');
                
                enemyZone.innerHTML = '';
                playerZone.innerHTML = '';

                this.fieldCards.enemy.forEach((card, index) => {
                    const fieldCard = this.createFieldCard(card, 'enemy');
                    enemyZone.appendChild(fieldCard);
                    
                    setTimeout(() => {
                        fieldCard.classList.add('field-placement');
                    }, index * 150);
                });

                this.fieldCards.player.forEach((card, index) => {
                    const fieldCard = this.createFieldCard(card, 'player');
                    playerZone.appendChild(fieldCard);
                    
                    setTimeout(() => {
                        fieldCard.classList.add('field-placement');
                    }, index * 150);
                });
            }

            createFieldCard(card, type) {
                const fieldCard = document.createElement('div');
                fieldCard.className = `field-card ${type}`;
                fieldCard.innerHTML = `
                    <div style="font-size: clamp(6px, 1.5vw, 8px); margin-bottom: 2px;">${card.position || ''}</div>
                    <div>${card.name}</div>
                `;
                return fieldCard;
            }

            toggleCardSelection(cardId) {
                const card = this.playerHand.find(c => c.id === cardId);
                if (!card || !card.element) return;

                if (this.selectedCards.has(cardId)) {
                    this.selectedCards.delete(cardId);
                    card.element.classList.remove('selected');
                } else {
                    this.selectedCards.add(cardId);
                    card.element.classList.add('selected');
                    
                    this.addSelectionEffect(card.element);
                }
            }

            addSelectionEffect(element) {
                element.style.transform = 'translateY(-12px) scale(1.05) rotateY(360deg)';
                setTimeout(() => {
                    element.style.transform = 'translateY(-12px) scale(1.05)';
                }, 600);
            }

            playSelectedCards() {
                if (this.selectedCards.size === 0) {
                    this.showMessage("Select cards to play!");
                    return;
                }

                let totalPower = 0;
                const playedCards = [];

                this.selectedCards.forEach(cardId => {
                    const cardIndex = this.playerHand.findIndex(c => c.id === cardId);
                    if (cardIndex !== -1) {
                        const card = this.playerHand[cardIndex];
                        playedCards.push(cardIndex);
                        
                        totalPower += card.cost + card.rarity;

                        this.fieldCards.player.push({
                            name: card.name,
                            position: card.position,
                            cost: card.cost,
                            rarity: card.rarity,
                            id: `field-${Date.now()}-${Math.random()}`,
                            element: null
                        });
                        
                        if (card.element) {
                            card.element.style.transform = 'scale(0) rotate(180deg)';
                            card.element.style.opacity = '0';
                        }
                    }
                });

                playedCards.sort((a, b) => b - a);
                
                setTimeout(() => {
                    playedCards.forEach(cardIndex => {
                        this.playerHand.splice(cardIndex, 1);
                    });
                    
                    this.discardRemainingHand();
                    
                    this.renderFieldCards();
                    this.endRound(totalPower);
                }, 300);

                this.selectedCards.clear();
            }

            discardSelected() {
                if (this.selectedCards.size === 0) {
                    this.showMessage("Select cards to discard!");
                    return;
                }

                if (this.hasDiscardedThisRound) {
                    this.showMessage("You can only discard once per round!");
                    return;
                }

                const discardCount = this.selectedCards.size;
                const cardsToDiscard = [];

                this.selectedCards.forEach(cardId => {
                    const cardIndex = this.playerHand.findIndex(c => c.id === cardId);
                    if (cardIndex !== -1) {
                        const card = this.playerHand[cardIndex];
                        this.playerDiscardPile.push({
                            name: card.name,
                            cost: card.cost,
                            rarity: card.rarity,
                            position: card.position
                        });
                        cardsToDiscard.push(cardIndex);
                    }
                });

                cardsToDiscard.sort((a, b) => b - a);

                cardsToDiscard.forEach((cardIndex, i) => {
                    const card = this.playerHand[cardIndex];
                    if (card.element) {
                        card.element.style.transform = 'translateX(-200px) rotate(-90deg)';
                        card.element.style.opacity = '0';
                        
                        setTimeout(() => {
                            this.playerHand.splice(cardIndex, 1);
                            
                            if (i === cardsToDiscard.length - 1) {
                                this.drawPlayerCards(discardCount);
                                this.renderHand();
                            }
                        }, 300);
                    }
                });

                this.selectedCards.clear();
                this.hasDiscardedThisRound = true;
                this.updateUI();
                this.showMessage(`Discarded ${discardCount} cards, drew ${Math.min(discardCount, this.getNumberOfCardsInPlayerDrawPile())} new cards`);
            }

            clearField() {
                this.fieldCards.player.forEach(card => {
                    this.playerDiscardPile.push({
                        name: card.name,
                        cost: card.cost,
                        rarity: card.rarity,
                        position: card.position
                    });
                });

                this.fieldCards.enemy.forEach(card => {
                    this.enemyDiscardPile.push({
                        name: card.name,
                        cost: card.cost,
                        rarity: card.rarity,
                        position: card.position
                    });
                });
                
                this.fieldCards.player = [];
                this.fieldCards.enemy = [];
                
                this.renderFieldCards();
                
                this.showMessage("⚡ Field cleared! Cards added to discard piles");
            }

            getCardCostByName(name) {
                const cardData = {
                    'MAHOMES': 8, 'ALLEN': 7, 'BURROW': 6, 'HURTS': 5, 'LAMAR': 6,
                    'MCCAFFREY': 8, 'HENRY': 7, 'CHUBB': 5, 'COOK': 4,
                    'JEFFERSON': 7, 'KUPP': 6, 'ADAMS': 6, 'DIGGS': 5,
                    'KELCE': 7, 'WATT': 8
                };
                return cardData[name] || 5;
            }

            getCardRarityByName(name) {
                const cardData = {
                    'MAHOMES': 6, 'ALLEN': 6, 'BURROW': 5, 'HURTS': 4, 'LAMAR': 5,
                    'MCCAFFREY': 6, 'HENRY': 5, 'CHUBB': 4, 'COOK': 3,
                    'JEFFERSON': 6, 'KUPP': 5, 'ADAMS': 5, 'DIGGS': 4,
                    'KELCE': 6, 'WATT': 6
                };
                return cardData[name] || 4;
            }

            getEnemyCardCostByName(name) {
                const cardData = {
                    'RODGERS': 7, 'WILSON': 6, 'PRESCOTT': 5, 'STAFFORD': 5, 'JONES': 4,
                    'BARKLEY': 7, 'JONES II': 6, 'MIXON': 5, 'HARRIS': 4,
                    'HILL': 7, 'CHASE': 6, 'HOPKINS': 5, 'EVANS': 5,
                    'KITTLE': 6, 'DONALD': 8
                };
                return cardData[name] || 5;
            }

            getEnemyCardRarityByName(name) {
                const cardData = {
                    'RODGERS': 5, 'WILSON': 4, 'PRESCOTT': 4, 'STAFFORD': 3, 'JONES': 3,
                    'BARKLEY': 5, 'JONES II': 4, 'MIXON': 4, 'HARRIS': 3,
                    'HILL': 6, 'CHASE': 5, 'HOPKINS': 4, 'EVANS': 4,
                    'KITTLE': 5, 'DONALD': 6
                };
                return cardData[name] || 4;
            }

            discardRemainingHand() {
                this.playerHand.forEach(card => {
                    this.playerDiscardPile.push({
                        name: card.name,
                        cost: card.cost,
                        rarity: card.rarity,
                        position: card.position
                    });
                });
                
                this.playerHand = [];
            }

            drawPlayerCards(count) {
                const cardsToDraw = count;
                
                for (let i = 0; i < cardsToDraw; i++) {
                    const newCard = this.playerDrawPile.shift();
                    if (newCard) {
                        newCard.id = `hand-${Date.now()}-${Math.random()}`;
                        this.playerHand.push(newCard);
                    }

                    if (this.getNumberOfCardsInPlayerDrawPile() === 0 && this.getNumberOfCardsInPlayerDiscardPile() > 0) {
                        this.shuffleDiscardIntoDeck();
                    }
                }
                
                this.cardsRemaining = this.getNumberOfCardsInPlayerDrawPile();
                this.updateUI();
            }

            shuffleDiscardIntoDeck() {
                const shuffled = [...this.playerDiscardPile].sort(() => Math.random() - 0.5);
                this.playerDrawPile.push(...shuffled);
                this.playerDiscardPile = [];
                this.showMessage("🔄 Deck reshuffled from discard pile!");
            }

            getNumberOfCardsInPlayerDrawPile() {
                return this.playerDrawPile.length;
            }

            getNumberOfCardsInPlayerDiscardPile() {
                return this.playerDiscardPile.length;
            }

            getNumberOfCardsInEnemyDrawPile() {
                return this.enemyDrawPile.length;
            }

            getNumberOfCardsInEnemyDiscardPile() {
                return this.enemyDiscardPile.length;
            }

            endRound(playerPower) {
                let enemyPower = 0;
                this.fieldCards.enemy.forEach(card => {
                    enemyPower += (card.cost || 0) + (card.rarity || 0);
                });
                
                const playerGain = Math.max(0, Math.floor((playerPower - enemyPower) / 2));
                const enemyGain = Math.max(0, Math.floor((enemyPower - playerPower) / 2));
                
                // Update yards and health bars
                this.playerYards += playerGain;
                this.enemyYards += enemyGain;
                
                this.playerYards = Math.min(100, this.playerYards);
                this.enemyYards = Math.min(100, this.enemyYards);
                
                // Update health bars if they exist
                if (this.playerYardsBar) {
                    this.playerYardsBar.setHealth(this.playerYards);
                }
                if (this.enemyYardsBar) {
                    this.enemyYardsBar.setHealth(this.enemyYards);
                }
                
                this.updateUI();
                this.showMessage(`Round ${this.round} Complete! You: ${playerPower} power (+${playerGain} yards), Enemy: ${enemyPower} power (+${enemyGain} yards)`);
                
                setTimeout(() => {
                    this.clearField();
                    
                    this.hasDiscardedThisRound = false;
                    this.round++;
                    
                    this.startNewRound();
                }, 2500);
                
                if (this.playerYards >= 100) {
                    setTimeout(() => this.showMessage("🏆 YOU WIN! Touchdown!"), 3000);
                } else if (this.enemyYards >= 100) {
                    setTimeout(() => this.showMessage("💀 YOU LOSE! Enemy scored!"), 3000);
                }
            }

            startNewRound() {
                this.drawPlayerCards(6);
                this.drawEnemyCards(6);
                
                const enemyPower = this.playEnemyCards();
                
                this.renderFieldCards();
                
                this.renderHand();
                this.updateUI();
                
                this.showMessage(`Round ${this.round} starts! Enemy played cards for ${enemyPower} power. Your turn!`);
            }

            showMessage(text) {
                const message = document.createElement('div');
                message.className = 'game-message';
                message.textContent = text;
                message.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0,0,0,0.9);
                    color: white;
                    padding: 15px 25px;
                    border-radius: 25px;
                    font-weight: bold;
                    z-index: 1000;
                    animation: messageFloat 3s ease-out forwards;
                    font-size: clamp(12px, 3vw, 16px);
                    max-width: 90vw;
                    text-align: center;
                `;
                
                document.body.appendChild(message);
                
                setTimeout(() => {
                    if (message.parentNode) {
                        message.parentNode.removeChild(message);
                    }
                }, 3000);
            }

            updateUI() {
                document.querySelector('.cards-remaining').textContent = `Draw Pile: ${this.getNumberOfCardsInPlayerDrawPile()}/${this.playerDeck.length} 🂡`;

                document.getElementById('enemyDeckInfo').textContent = `Enemy: ${this.getNumberOfCardsInEnemyDrawPile()}/${this.enemyDeck.length} 🂡`;
                
                if (this.enemyYardsBar) {
                    this.enemyYardsBar.add(10);
                }

                if (this.playerYardsBar) {
                    this.playerYardsBar.add(10);
                }

                const discardBtn = document.getElementById('discardBtn');
                if (this.hasDiscardedThisRound) {
                    discardBtn.style.opacity = '0.5';
                    discardBtn.style.cursor = 'not-allowed';
                } else {
                    discardBtn.style.opacity = '1';
                    discardBtn.style.cursor = 'pointer';
                }
            }

            setupEventListeners() {
                document.getElementById('playBtn').addEventListener('click', () => {
                    this.playSelectedCards();
                });

                document.getElementById('discardBtn').addEventListener('click', () => {
                    this.discardSelected();
                });
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const game = new GameState();
            game.init();
        });

        document.addEventListener('DOMContentLoaded', () => {
            const fieldSection = document.querySelector('.field-section');
            
            fieldSection.addEventListener('mousemove', (e) => {
                const rect = fieldSection.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                fieldSection.style.background = `
                    radial-gradient(circle at ${x}px ${y}px, 
                        rgba(255,255,255,0.1) 0%, 
                        transparent 51%), 
                    linear-gradient(180deg, #4CAF50 0%, #45a049 100%)
                `;
            });
            
            fieldSection.addEventListener('mouseleave', () => {
                fieldSection.style.background = 'linear-gradient(180deg, #4CAF50 0%, #45a049 100%)';
            });
        });
    </script>
    <script src="js/healthbar.js"></script>
</body>
</html>